# Environment Variables

This file documents the environment variables required for the admin_side module.

## Required Environment Variables

### NextAuth Configuration
```bash
# NextAuth URL (your application URL)
NEXTAUTH_URL=http://localhost:3002
# NextAuth secret (generate with: openssl rand -base64 32)
NEXTAUTH_SECRET=your-secret-key-here-generate-with-openssl-rand-base64-32
```

### Keycloak Provider for NextAuth
```bash
# Keycloak client ID
AUTH_KEYCLOAK_ID=my-blogs-admin-localhost
# Keycloak client secret
AUTH_KEYCLOAK_SECRET=jBYbpUPFAeqgbgm6u6ESilDuRNwlyjKN
# Keycloak issuer URL
AUTH_KEYCLOAK_ISSUER=https://my-ids-admin.ducth.dev/realms/master
# Keycloak scope (includes my-cms API access)
AUTH_KEYCLOAK_SCOPE=my-headless-cms-api-all email openid profile
```

### my-cms Backend API (https://github.com/doitsu2014/my-cms)
```bash
# GraphQL API endpoint (required)
PUBLIC_GRAPHQL_API_URL=http://localhost:8989/graphql
# GraphQL Cache API endpoint (optional)
PUBLIC_GRAPHQL_CACHE_API_URL=http://localhost:8989/graphql
# REST API base URL (my-cms also provides REST endpoints)
PUBLIC_REST_API_URL=http://localhost:8989/api
# Media upload endpoint
PUBLIC_MEDIA_UPLOAD_API_URL=http://localhost:8989/api/media/upload
```

### Cache Configuration (Optional)
```bash
# Enable homepage cache (optional)
HOME_PAGE_CACHE_ENABLED=false
```

## Development Setup

1. Copy this file to `.env.local` in the admin_side directory
2. Generate NEXTAUTH_SECRET: `openssl rand -base64 32`
3. Update the values according to your environment
4. Never commit `.env.local` to version control

## Example .env.local

```bash
# NextAuth
NEXTAUTH_URL=http://localhost:3002
NEXTAUTH_SECRET=your-generated-secret-here

# Keycloak Provider
AUTH_KEYCLOAK_ID=my-blogs-admin-localhost
AUTH_KEYCLOAK_SECRET=jBYbpUPFAeqgbgm6u6ESilDuRNwlyjKN
AUTH_KEYCLOAK_ISSUER=https://my-ids-admin.ducth.dev/realms/master
AUTH_KEYCLOAK_SCOPE=my-headless-cms-api-all email openid profile

# Backend API (my-cms)
PUBLIC_GRAPHQL_API_URL=http://localhost:8989/graphql
PUBLIC_GRAPHQL_CACHE_API_URL=http://localhost:8989/graphql
PUBLIC_REST_API_URL=http://localhost:8989/api
PUBLIC_MEDIA_UPLOAD_API_URL=http://localhost:8989/api/media/upload

# Optional
HOME_PAGE_CACHE_ENABLED=false
```

## Production Example

```bash
# NextAuth
NEXTAUTH_URL=https://admin.your-domain.com
NEXTAUTH_SECRET=your-production-secret-here

# Keycloak Provider
AUTH_KEYCLOAK_ID=admin-side-production
AUTH_KEYCLOAK_SECRET=your-production-client-secret
AUTH_KEYCLOAK_ISSUER=https://my-ids-admin.ducth.dev/realms/master
AUTH_KEYCLOAK_SCOPE=my-headless-cms-api-all email openid profile

# Backend API (my-cms production)
PUBLIC_GRAPHQL_API_URL=https://my-cms-api.ducth.dev/graphql
PUBLIC_GRAPHQL_CACHE_API_URL=https://my-cms-api.ducth.dev/graphql
PUBLIC_REST_API_URL=https://my-cms-api.ducth.dev/api
PUBLIC_MEDIA_UPLOAD_API_URL=https://my-cms-api.ducth.dev/api/media/upload

# Optional
HOME_PAGE_CACHE_ENABLED=true
```

## Notes

- **NextAuth**: Modern authentication library with built-in OAuth support
  - Replaces keycloak-js for better stability and features
  - Uses Authorization Code Flow with PKCE
  - Automatic token refresh
- **my-cms Backend**: https://github.com/doitsu2014/my-cms (Rust-based headless CMS)
  - Provides both **GraphQL** and **REST API** endpoints
  - Default port: 8989
- **Keycloak**: Authentication uses Authorization Code Flow with PKCE
- **Scope**: `my-headless-cms-api-all` grants access to my-cms API endpoints
- **PKCE**: Must be enabled (S256) in Keycloak client configuration
- Make sure my-cms backend is running before starting admin_side
